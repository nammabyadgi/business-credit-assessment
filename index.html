<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Business Credit Assessment Tool</title>
<link rel="icon" href="data:,">
<style>
body{font-family:Segoe UI,Roboto,sans-serif;background:#f8fafc;padding:20px}
.card{background:#fff;border-radius:10px;padding:20px;margin-bottom:20px}
button{padding:10px 16px;border:none;border-radius:6px;cursor:pointer}
.btn{background:#208791;color:#fff;font-weight:600}
input{width:100%;padding:10px;margin-top:6px;margin-bottom:14px}
#spinner{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#208791;color:#fff;padding:30px;border-radius:10px;display:none}
</style>
</head>

<body>

<div class="card">
<h2>Business Details</h2>

<label>Business Name *</label>
<input id="businessName" placeholder="Enter business / trade name">

<button class="btn" onclick="autoFill()">üîç AI Search</button>

<label>GST Number</label>
<input id="gstNumber">

<label>IndiaMART Link</label>
<input id="indiaMartLink">

<label>Google Maps Link</label>
<input id="googleMapsLink">

<label>Website</label>
<input id="website">

<label>Average Rating</label>
<input id="rating">
</div>

<div id="spinner">üîç Verifying business from internet‚Ä¶<br><small>May take up to 30 seconds</small></div>

<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwZlUnox0pcQaQA_ogMHHqeQK0XyaEf-saVLcAT-11ILpJ8Gjn5D6Z30X86hr7RKSSb/exec';
let searching = false;

function showSpinner(){document.getElementById('spinner').style.display='block'}
function hideSpinner(){document.getElementById('spinner').style.display='none'}

async function queryBackend(prompt, timeout=30000){
  const controller = new AbortController();
  setTimeout(()=>controller.abort(), timeout);

  const res = await fetch(GAS_URL,{
    method:'POST',
    body:`prompt=${encodeURIComponent(prompt)}`,
    signal:controller.signal
  });

  const text = await res.text();
  const json = JSON.parse(text);
  if(!json.success) throw new Error(json.error);
  const match = json.result.match(/\{[\s\S]*\}/);
  if(!match) throw new Error('No JSON');
  return JSON.parse(match[0]);
}

async function autoFill(){
  if(searching) return;
  const name = document.getElementById('businessName').value.trim();
  if(!name){alert('Enter business name');return;}

  searching = true;
  showSpinner();

  const prompt = `
Find verified business information for "${name}" in India.

Rules:
- Use only publicly available internet sources
- Do NOT guess GST numbers
- Return STRICT JSON only

JSON:
{
  "business_name":"",
  "gst_number":"",
  "indiamart_url":"",
  "google_maps_url":"",
  "website":"",
  "google_rating":"",
  "confidence":0,
  "sources":[]
}
`;

  try{
    const data = await queryBackend(prompt);

    if(!data.business_name){
      alert('Business not found in public sources');
      return;
    }

    if(data.gst_number) document.getElementById('gstNumber').value = data.gst_number;
    if(data.indiamart_url) document.getElementById('indiaMartLink').value = data.indiamart_url;
    if(data.google_maps_url) document.getElementById('googleMapsLink').value = data.google_maps_url;
    if(data.website) document.getElementById('website').value = data.website;
    if(data.google_rating) document.getElementById('rating').value = data.google_rating;

    alert('Business verified successfully');

  }catch(e){
    if(e.name==='AbortError'){
      alert('Verification timed out. Please retry.');
    }else{
      alert('Verification failed. Try again.');
    }
  }finally{
    hideSpinner();
    searching=false;
  }
}
</script>

</body>
</html>
